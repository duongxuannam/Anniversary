---
const startDate = new Date("2022-02-13T00:00:00+07:00");
const endDate = new Date("2026-02-14T00:00:00+07:00");
const totalDays = Math.floor((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));
const baseUrl = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
---

<html lang='vi'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width' />
    <meta
      name='description'
      content='Kỷ niệm 4 năm yêu nhau của Xuân Nam và Diệu Linh (13/02/2022 - 14/02/2026).'
    />
    <title>Kỷ niệm 4 năm yêu nhau | Xuân Nam ❤ Diệu Linh</title>
    <style>
      :root {
        --pink: #ff6fa3;
        --rose: #ff90b3;
        --dark: #2d1a28;
        --soft: #fff6fb;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: 'Be Vietnam Pro', system-ui, sans-serif;
        color: var(--dark);
        background: radial-gradient(circle at top, #ffd6e7, #fff);
        overflow-x: hidden;
      }

      .floating-hearts {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
      }

      .heart {
        position: absolute;
        color: rgba(255, 100, 156, 0.4);
        font-size: clamp(18px, 2.2vw, 36px);
        animation: floatUp var(--duration) linear infinite;
        animation-delay: var(--delay);
      }

      @keyframes floatUp {
        from {
          transform: translateY(105vh) scale(0.6);
          opacity: 0;
        }

        20% {
          opacity: 1;
        }

        to {
          transform: translateY(-20vh) scale(1);
          opacity: 0;
        }
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 980px;
        margin: 0 auto;
        padding: 2.5rem 1.2rem 4rem;
      }

      .hero {
        text-align: center;
        padding: 2rem;
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.65);
        backdrop-filter: blur(8px);
        box-shadow: 0 14px 40px rgba(255, 105, 149, 0.18);
      }

      h1 {
        margin: 0;
        font-size: clamp(1.8rem, 5vw, 3.2rem);
      }

      .hero-title {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        align-items: center;
      }

      .names {
        color: var(--pink);
        text-shadow: 0 4px 16px rgba(255, 111, 163, 0.35);
      }

      .date {
        margin: 1rem 0;
        font-weight: 600;
      }

      .counter {
        display: inline-block;
        margin-top: 0.6rem;
        padding: 0.8rem 1.2rem;
        border-radius: 999px;
        background: linear-gradient(120deg, var(--pink), var(--rose));
        color: #fff;
        font-weight: 700;
      }

      .love-grid {
        margin-top: 2rem;
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .card {
        border-radius: 18px;
        padding: 1rem;
        background: #fff;
        border: 1px solid #ffe3ef;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 14px 25px rgba(255, 126, 171, 0.24);
      }

      .card h2 {
        margin-top: 0;
      }

      .gallery {
        margin-top: 2.2rem;
      }

      .gallery-header {
        text-align: center;
        margin-bottom: 1rem;
      }

      .gallery-header h2 {
        margin: 0;
        color: var(--pink);
      }

      .gallery-header p {
        margin: 0.45rem 0 0;
      }

      .photo-grid {
        column-count: 2;
        column-gap: 0.9rem;
      }

      .photo {
        margin: 0;
        margin-bottom: 0.9rem;
        border-radius: 18px;
        overflow: hidden;
        background: #fff;
        border: 1px solid #ffd9e9;
        box-shadow: 0 10px 26px rgba(255, 111, 163, 0.2);
        break-inside: avoid;
      }

      .photo img {
        display: block;
        width: 100%;
        height: auto;
      }

      @media (max-width: 640px) {
        .photo-grid {
          column-count: 1;
        }
      }

      @media (max-width: 760px) {
        .love-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .love-grid .card:last-child {
          grid-column: 1 / -1;
        }
      }

      @media (max-width: 560px) {
        .love-grid {
          grid-template-columns: 1fr;
        }

        .love-grid .card:last-child {
          grid-column: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class='floating-hearts' aria-hidden='true'>
      {Array.from({ length: 16 }, (_, i) => (
        <span
          class='heart'
          style={`left: ${5 + i * 6}%; --delay: ${i * 0.7}s; --duration: ${6 + (i % 5)}s;`}
        >
          ❤
        </span>
      ))}
    </div>

    <main class='container'>
      <section class='hero'>
        <h1 class='hero-title'>
          <span>Kỷ niệm 4 năm yêu nhau</span>
          <span class='names'>Xuân Nam ❤ Diệu Linh</span>
        </h1>
        <p class='date'>13/02/2022 - 14/02/2026</p>
        <span class='counter'>{totalDays} ngày cùng nhau, và còn mãi về sau ✨</span>
      </section>

      <section class='love-grid'>
        <article class='card'>
          <h2>Khoảnh khắc đầu tiên</h2>
          <p>Ngày ta chọn nắm tay nhau, mọi thứ đều trở nên dịu dàng và ý nghĩa hơn.</p>
        </article>
        <article class='card'>
          <h2>Những điều đáng yêu</h2>
          <p>Từ tin nhắn chúc ngủ ngon cho đến những cái ôm thật chặt, ta luôn ở bên nhau.</p>
        </article>
        <article class='card'>
          <h2>Lời hứa tương lai</h2>
          <p>Cùng nhau trưởng thành, cùng nhau mỉm cười và tạo nên thật nhiều kỷ niệm đẹp.</p>
        </article>
      </section>

      <section class='gallery'>
        <div class='gallery-header'>
          <h2>Khoảnh khắc của tụi mình</h2>
          <p>Mỗi tấm hình là một lần tim rung lên thêm chút nữa.</p>
        </div>

        <div class='photo-grid'>
          <figure class='photo'>
            <img src={`${baseUrl}images/moment-01.jpg`} alt='Cả hai chụp selfie bên bờ biển lúc hoàng hôn.' width='1536' height='2048' loading='eager' decoding='async' fetchpriority='high' sizes='(max-width: 640px) 92vw, (max-width: 980px) 46vw, 440px' />
          </figure>
          <figure class='photo'>
            <img src={`${baseUrl}images/moment-02.jpg`} alt='Hai bạn chụp ảnh dễ thương trong chuyến đi.' width='1536' height='2048' loading='lazy' decoding='async' sizes='(max-width: 640px) 92vw, (max-width: 980px) 46vw, 440px' />
          </figure>
          <figure class='photo'>
            <img src={`${baseUrl}images/moment-03.jpg`} alt='Khoảnh khắc hôn má ngọt ngào trên biển.' width='1536' height='2048' loading='lazy' decoding='async' sizes='(max-width: 640px) 92vw, (max-width: 980px) 46vw, 440px' />
          </figure>
          <figure class='photo'>
            <img src={`${baseUrl}images/moment-04.jpg`} alt='Nụ cười hạnh phúc của cả hai vào buổi tối.' width='1536' height='2048' loading='lazy' decoding='async' sizes='(max-width: 640px) 92vw, (max-width: 980px) 46vw, 440px' />
          </figure>
          <figure class='photo'>
            <img src={`${baseUrl}images/moment-05.jpg`} alt='Bức ảnh kỷ niệm vui vẻ của cả hai.' width='946' height='2048' loading='lazy' decoding='async' sizes='(max-width: 640px) 92vw, (max-width: 980px) 46vw, 440px' />
          </figure>
        </div>
      </section>
    </main>
    <script>
      // @ts-nocheck
      const audioWindow = window;
      const AudioContextClass = audioWindow.AudioContext || audioWindow.webkitAudioContext;
      let audioContext = null;
      let hasPlayed = false;

      const midiToFreq = (midi) => 440 * 2 ** ((midi - 69) / 12);

      const playNote = (
        context,
        freq,
        startTime,
        duration,
        type,
        volume
      ) => {
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();

        oscillator.type = type;
        oscillator.frequency.setValueAtTime(freq, startTime);

        gainNode.gain.setValueAtTime(0.0001, startTime);
        gainNode.gain.exponentialRampToValueAtTime(volume, startTime + 0.04);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, startTime + duration);

        oscillator.connect(gainNode);
        gainNode.connect(context.destination);

        oscillator.start(startTime);
        oscillator.stop(startTime + duration + 0.02);
      };

      const ensureAudioContext = () => {
        if (!AudioContextClass) {
          return null;
        }

        if (!audioContext) {
          audioContext = new AudioContextClass();
        }

        return audioContext;
      };

      const scheduleRomanticSong = (context, startTime) => {
        const beat = 60 / 84;
        const sectionBars = 8;
        const progression = [
          [60, 64, 67],
          [57, 60, 64],
          [65, 69, 72],
          [67, 71, 74],
          [60, 64, 67],
          [57, 60, 64],
          [62, 65, 69],
          [67, 71, 74]
        ];
        const melodyA = [72, 74, 76, 74, 72, 71, 69, 67];
        const melodyB = [72, 76, 79, 76, 74, 72, 71, 69];

        for (let bar = 0; bar < sectionBars; bar += 1) {
          const chord = progression[bar];
          const sectionStart = startTime + bar * beat * 4;

          for (const note of chord) {
            playNote(context, midiToFreq(note), sectionStart, beat * 3.8, 'triangle', 0.045);
            playNote(context, midiToFreq(note + 12), sectionStart + beat * 2, beat * 1.8, 'sine', 0.018);
          }

          playNote(context, midiToFreq(chord[0] - 12), sectionStart, beat * 0.9, 'sine', 0.03);
          playNote(context, midiToFreq(chord[0] - 12), sectionStart + beat * 2, beat * 0.9, 'sine', 0.03);

          const phrase = bar < 4 ? melodyA : melodyB;
          for (let step = 0; step < phrase.length; step += 1) {
            const note = phrase[step];
            const noteStart = sectionStart + step * (beat * 0.5);
            playNote(context, midiToFreq(note), noteStart, beat * 0.45, 'sine', 0.05);
          }
        }

        return beat * 4 * sectionBars;
      };

      const startMelody = async () => {
        if (hasPlayed) {
          return true;
        }

        const context = ensureAudioContext();
        if (!context) {
          return false;
        }

        try {
          if (context.state !== 'running') {
            await context.resume();
          }

          let nextStart = context.currentTime + 0.08;
          const loopDuration = scheduleRomanticSong(context, nextStart);
          nextStart += loopDuration;

          window.setInterval(() => {
            scheduleRomanticSong(context, nextStart);
            nextStart += loopDuration;
          }, Math.floor(loopDuration * 1000) - 120);

          hasPlayed = true;
          return true;
        } catch {
          return false;
        }
      };

      const startFromUserInteraction = async () => {
        const started = await startMelody();
        if (started) {
          window.removeEventListener('pointerdown', startFromUserInteraction);
          window.removeEventListener('keydown', startFromUserInteraction);
        }
      };

      window.addEventListener('pointerdown', startFromUserInteraction);
      window.addEventListener('keydown', startFromUserInteraction);

      startMelody();
    </script>
  </body>
</html>
